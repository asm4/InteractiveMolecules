<!DOCTYPE html>
<html>
<head>
<title>WebGL</title>
<script type="text/javascript" src="js/three.js"></script>
<script type="text/javascript" src="js/jquery2.2.0.min.js"></script>
	<!-- Javascript code that runs our Three.js examples -->
	<script type="text/javascript">
		// once everything is loaded, we run our Three.js stuff.
		var plane,cube,sphere,scene,camera,renderer;
		var keys = [];
		$(function () {
			var updateLoop = setInterval(update,1);
			// here we'll put the Three.js stuff
			scene = new THREE.Scene();
			camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
			//camera.rotateOnAxis(new THREE.Vector3(1,0,0),(45*(Math.PI/180)));
			renderer = new THREE.WebGLRenderer();
			renderer.setClearColor(0x333333);
			renderer.setSize(window.innerWidth, window.innerHeight);
			var axes = new THREE.AxisHelper(5);
			scene.add(axes);
			var planeGeometry = new THREE.PlaneGeometry(60,20,1,1);
			var planeMaterial = new THREE.MeshBasicMaterial({color: 0xcccccc});
			plane = new THREE.Mesh(planeGeometry,planeMaterial);
			plane.rotation.x=-0.5*Math.PI;
			plane.position.x = 15;
			plane.position.y = 0;
			plane.position.z = 0;
			scene.add(plane);
			var cubeGeometry = new THREE.CubeGeometry(4,4,4);
			var cubeMaterial = new THREE.MeshBasicMaterial({color: 0xff0000, wireframe: true});
			cube = new THREE.Mesh(cubeGeometry, cubeMaterial);
			cube.position.x = -4;
			cube.position.y = 3;
			cube.position.z = 0;
			scene.add(cube);
			var sphereGeometry = new THREE.SphereGeometry(4,20,20);
			var sphereMaterial = new THREE.MeshBasicMaterial({color: 0x7777ff, wireframe: true});
			sphere = new THREE.Mesh(sphereGeometry,sphereMaterial);
			sphere.position.x = 20;
			sphere.position.y = 4;
			sphere.position.z = 2;
			scene.add(sphere);
			camera.position.x = 0;
			camera.position.y = 5;
			camera.position.z = 30;

			camera.lookAt(scene.position);
			$("#WebGL-output").append(renderer.domElement);
			renderer.render(scene, camera);

			$(window).on('keydown',function(e){
				var key = e.which;
				//console.log(key);
				if($.inArray(key,keys) == -1) {

					if (key == 17) {
						keys.push(17);
					}
					if (key == 18) {
						keys.push(18);
					}
					if (key == 37) { //console.log("left");
						keys.push(37);
						camera.position.x--;
					}
					if (key == 38) { //console.log("up");
						keys.push(38);
						camera.position.y++;
					}
					if (key == 39) { //console.log("right");
						camera.position.x++;
					}
					if (key == 40) { //console.log("down");
						camera.position.y--;
					}
					if (key == 65) {
						addSphere();
					}
					if(key == 82){
						camera.rotation.x = 0;
						camera.rotation.y = 0;
						camera.rotation.z = 0;
					}
				}
				render();
			});
			$(window).on('keyup',function(e){
				var key = e.which;
				keys = jQuery.grep(keys, function(value) {
					return value != key;
				});

			});

			var held;
			var startPos;
			var lastPos;
			$(window).mousedown(function(e) {
				held = true;
				lastPos = Array(e.offsetX, e.offsetY);
			}).bind('mouseup mouseleave', function() {
				held = false;
			});
			$(window).on('mousemove',function(e){

				if(held){
					if(keys.indexOf(17) != -1){
						startPos = Array(e.offsetX, e.offsetY);
						var yAmt = (lastPos[0] - startPos[0]) / 500;
						var xAmt = (lastPos[1] - startPos[1]) / 500;
						camera.rotateY(yAmt);
						camera.rotateX(xAmt);
						
						//console.log(camera.rotation);
						lastPos = startPos;
					}
					else {

						startPos = Array(e.offsetX, e.offsetY);
						var xPos = (lastPos[0] - startPos[0]) / 50;
						var yPos = (lastPos[1] - startPos[1]) / 50;
						//var position = THREE.Vector3(xPos,yPos,camera.position.z);
						camera.position.x += xPos;
						camera.position.y -= yPos;

						lastPos = startPos;
					}
					render();
				}
			});
			$(window).on('mousewheel',function(e){
				//console.log(e.originalEvent.wheelDelta/120);
				var scrollAmt = (e.originalEvent.wheelDelta/120)/5;
				var frac = scrollAmt/2*Math.PI;
				camera.position.z -= scrollAmt;
				//camera.position.x += scrollAmt;
				console.log(Rads2Degs(camera.rotation.x),Rads2Degs(camera.rotation.y),Rads2Degs(camera.rotation.z));
//				if(camera.zoom < 0) camera.zoom = 0;
//				camera.updateProjectionMatrix();
				render();
			});
		});
		function Rads2Degs(radians){
			return (radians*180)/Math.PI;
		}
		function update(){
			//console.dir(keys);
			//keys = [];
		}
		function render(){
			renderer.render(scene,camera);
		}
		function addSphere(){
			var sphere = new THREE.Mesh(new THREE.SphereGeometry(10,20,20),new THREE.MeshBasicMaterial({color: 0x00AA00, wireframe:true}));
			sphere.position.x = 0;
			sphere.position.y = 10;
			sphere.position.z = 0;
			//sphere.makeRotationX(0.5);
			scene.add(sphere);
		}
		</script>
	<style>
		body{
			/* set margin to 0 and overflow to hidden,
			to use the complete page */
			margin: 0;
			overflow: hidden;
		}
		div{

		}
	</style>
</head>
<body>
<!-- canvas which will hold the Output -->
<div id="WebGL-output">
</div>
</body>
</html>