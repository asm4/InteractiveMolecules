<!DOCTYPE html>
<html>
<head>
<title>WebGL</title>
<script type="text/javascript" src="js/three.js"></script>
<script type="text/javascript" src="js/jquery2.2.0.min.js"></script>
<!-- Javascript code that runs our Three.js examples -->
<script type="text/javascript">
    // once everything is loaded, we run our Three.js stuff.
    var debugKeys = false;
    var plane,cube,sphere,scene,camera,renderer;
    var keys = [];
    var KEY_CODES = {
        "CTRL":17,
        "ALT":18,
        "ARROW_LEFT":37,
        "ARROW_UP":38,
        "ARROW_RIGHT":39,
        "ARROW_DOWN":40,
        "KEY_A":65,
        "KEY_R":82
    }
    $(function () {
        var updateLoop = setInterval(update,1);
        // here we'll put the Three.js stuff
        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
        //camera.rotateOnAxis(new THREE.Vector3(1,0,0),(45*(Math.PI/180)));
        renderer = new THREE.WebGLRenderer();
        renderer.setClearColor(0x333333);
        renderer.setSize(window.innerWidth, window.innerHeight);
        var axes = new THREE.AxisHelper(5);
        scene.add(axes);
        var planeGeometry = new THREE.PlaneGeometry(60,20,1,1);
        var planeMaterial = new THREE.MeshBasicMaterial({color: 0xcccccc});
        plane = new THREE.Mesh(planeGeometry,planeMaterial);
        plane.rotation.x=-0.5*Math.PI;
        plane.position.x = 15;
        plane.position.y = 0;
        plane.position.z = 0;
        scene.add(plane);
        var cubeGeometry = new THREE.CubeGeometry(4,4,4);
        var cubeMaterial = new THREE.MeshBasicMaterial({color: 0xff0000, wireframe: true});
        cube = new THREE.Mesh(cubeGeometry, cubeMaterial);
        cube.position.x = -4;
        cube.position.y = 3;
        cube.position.z = 0;
        scene.add(cube);
        var sphereGeometry = new THREE.SphereGeometry(4,20,20);
        var sphereMaterial = new THREE.MeshBasicMaterial({color: 0x7777ff, wireframe: true});
        sphere = new THREE.Mesh(sphereGeometry,sphereMaterial);
        sphere.position.x = 20;
        sphere.position.y = 4;
        sphere.position.z = 2;
        scene.add(sphere);
        camera.position.x = 0;
        camera.position.y = 5;
        camera.position.z = 30;
        camera.lookAt(scene.position);
        displayCameraPosition(camera.position);
        displayCameraRotation(camera.rotation);
        $("#WebGL-output").append(renderer.domElement);
        renderer.render(scene, camera);

        $(window).on('keydown',function(e){
            var key = e.which;
            if(debugKeys)console.log(key);
            if($.inArray(key,keys) == -1) {

                if (key == KEY_CODES.CTRL) {
                    keys.push(KEY_CODES.CTRL);
                }
                if (key == KEY_CODES.ALT) {
                    keys.push(KEY_CODES.ALT);
                }
                if (key == KEY_CODES.ARROW_LEFT) { //console.log("left");
                    keys.push(KEY_CODES.ARROW_LEFT);
                    camera.position.x--;
                }
                if (key == KEY_CODES.ARROW_UP) { //console.log("up");
                    keys.push(KEY_CODES.ARROW_UP);
                    camera.position.y++;
                }
                if (key == KEY_CODES.ARROW_RIGHT) { //console.log("right");
                    camera.position.x++;
                }
                if (key == KEY_CODES.ARROW_DOWN) { //console.log("down");
                    camera.position.y--;
                }
                if (key == KEY_CODES.KEY_A) {
                    addSphere();
                }
                if(key == KEY_CODES.KEY_R){
                    camera.rotation.x = 0;
                    camera.rotation.y = 0;
                    camera.rotation.z = 0;
                    displayCameraRotation(camera.rotation);
                }
            }
            render();
        });
        $(window).on('keyup',function(e){
            var key = e.which;
            keys = jQuery.grep(keys, function(value) {
                return value != key;
            });

        });

        var held;
        var startPos;
        var lastPos;
        $(window).mousedown(function(e) {
            held = true;
            lastPos = Array(e.offsetX, e.offsetY);
        }).bind('mouseup mouseleave', function() {
            held = false;
        });
        $(window).on('mousemove',function(e){

            if(held){
                if(keys.indexOf(KEY_CODES.ALT) != -1){
                    startPos = Array(e.offsetX, e.offsetY);
                    var yAmt = (lastPos[0] - startPos[0]) / 500;
                    var xAmt = (lastPos[1] - startPos[1]) / 500;
                    camera.rotateY(yAmt);
                    camera.rotateX(xAmt);

                    //console.log(camera.rotation);
                    lastPos = startPos;
                    displayCameraRotation(camera.rotation);
                }
                else {

                    startPos = Array(e.offsetX, e.offsetY);
                    var xPos = (lastPos[0] - startPos[0]) / 50;
                    var yPos = (lastPos[1] - startPos[1]) / 50;
                    //var position = THREE.Vector3(xPos,yPos,camera.position.z);
                    camera.position.x += xPos;
                    camera.position.y -= yPos;
                    lastPos = startPos;
                    displayCameraPosition(camera.position);
                }
                render();
            }
        });
        $(window).on('mousewheel',function(e){
            //console.log(e.originalEvent.wheelDelta/120);
            var scrollAmt = (e.originalEvent.wheelDelta/120)/5;
            var frac = scrollAmt/2*Math.PI;
            camera.position.z -= scrollAmt;
            displayCameraPosition(camera.position);
            //camera.position.x += scrollAmt;
            //console.log(Rads2Degs(camera.rotation.x),Rads2Degs(camera.rotation.y),Rads2Degs(camera.rotation.z));
//				if(camera.zoom < 0) camera.zoom = 0;
//				camera.updateProjectionMatrix();
            render();
        });
        
        $("#debugKeys").change(function(e){
            debugKeys = e.originalEvent.srcElement.checked;
        });
    });
    function displayCameraRotation(cameraRotation){
        $("#cameraRotX").html(cameraRotation.x);
        $("#cameraRotY").html(cameraRotation.y);
        $("#cameraRotZ").html(cameraRotation.z);
    }
    function displayCameraPosition(cameraPosition){
        $("#cameraPosX").html(cameraPosition.x);
        $("#cameraPosY").html(cameraPosition.y);
        $("#cameraPosZ").html(cameraPosition.z);
    }
    function Rads2Degs(radians){
        return (radians*180)/Math.PI;
    }
    function update(){
        //console.dir(keys);
        //keys = [];
    }
    function render(){
        renderer.render(scene,camera);
    }
    function addSphere(){
        var sphere = new THREE.Mesh(new THREE.SphereGeometry(10,20,20),new THREE.MeshBasicMaterial({color: 0x00AA00, wireframe:true}));
        sphere.position.x = 0;
        sphere.position.y = 10;
        sphere.position.z = 0;
        //sphere.RotateX(0.5);
        scene.add(sphere);
    }
    </script>
	<style>
        *{
            -webkit-user-select: none;
        }
		body{
			/* set margin to 0 and overflow to hidden,
			to use the complete page */
			margin: 0;
			overflow: hidden;
            font-family: sans-serif;
		}
		#WebGL-output{
            position: absolute;
            z-index: 1;
            cursor: default;
		}
        #controls{
            position: absolute;
            z-index: 2;
            color: whitesmoke;
            background-color: rgba(0,0,0,0.2);
            margin: 15px;
            padding: 15px;
            padding-top: 0;
            width: 300px;
            text-align:  left;
        }
        #controls h4{
            margin: 0;
        }
        #controls h2{
            margin: 0;
            text-align: center;
        }
	</style>
</head>
<body>
<!-- canvas which will hold the Output -->
<div id="WebGL-output">
</div>
<div id="controls"><h2>Controls</h2>
    <fieldset><legend>Debug</legend>
        <input id="debugKeys" type="checkbox" /><label for="debugKeys"> KEYS</label>
        <br>
<!--        <input id="debugCamera" type="checkbox" /><label for="debugKeys"> CAMERA POSITION</label>-->
    </fieldset>
    <fieldset>
        <legend>Camera</legend>
        <h5>Postion</h5>
        <label for="cameraPosX">X: </label><span id="cameraPosX"></span>
        <br>
        <label for="cameraPosY">Y: </label><span id="cameraPosY"></span>
        <br>
        <label for="cameraPosZ">Z: </label><span id="cameraPosZ"></span>
        <h5>Rotation</h5>
        <label for="cameraRotX">X: </label><span id="cameraRotX"></span>
        <br>
        <label for="cameraRotY">Y: </label><span id="cameraRotY"></span>
        <br>
        <label for="cameraRotZ">Z: </label><span id="cameraRotZ"></span>
    </fieldset>
</div>
</body>
</html>