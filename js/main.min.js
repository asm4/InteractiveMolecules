function CreatePlane(e,o,t,n,i,a){var r,s=new THREE.PlaneGeometry(e,o,t,n),l=new THREE.TextureLoader;return l.load(a,function(e){r=new THREE.MeshBasicMaterial({map:e})},function(e){console.log(e.loaded/e.total*100+"% loaded")},function(){console.log("An error loading texture occured.")}),new THREE.Mesh(s,r)}function CreateAtom(e){var o=new THREEx.DynamicTexture(512,512);o.context.font="bold 90px Verdana",o.texture.anisotropy=renderer.getMaxAnisotropy(),o.clear(e.color),o.drawText(e.shortName+"      "+e.shortName,96,256,e.textColor);var t=new THREE.SphereGeometry(e.radius,20,20),n=new THREE.MeshLambertMaterial({map:o.texture}),i=new THREE.Mesh(t,n);return i.name="atom",i.userData=e,i}function BondAtoms(e,o,t){t=t||1;for(var n=[],i=0;t>i;i++){var a=e.position,s=o.position,r=(new THREE.Vector3).subVectors(a,s),l=new THREE.Matrix4;l.lookAt(s,a,(new THREE.Object3D).up),l.multiply((new THREE.Matrix4).set(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1));var c=CreateBondLine(.4,.4,r.length(),20);c.name="line",c.applyMatrix(l),c.position.x=(a.x+s.x)/2,c.position.y=(a.y+s.y)/2,c.position.z=(a.z+s.z)/2,molecule.BONDS.push(c),n.push(c),scene.add(c)}n.length>=2&&(n[0].position.x-=.6,n[0].position.y-=.6,n[0].position.z-=.6,n[n.length-1].position.x+=.6,n[n.length-1].position.y+=.6,n[n.length-1].position.z+=.6)}function CreateBondLine(e,o,t,n){var i=new THREE.CylinderGeometry(e,o,t,n,1),a=new THREE.MeshLambertMaterial({color:"#000000",emissive:"#CCCCCC"}),s=new THREE.Mesh(i,a);return s}function AddMolecule(e){molecule.reset(),ClearScene();var o=e;$.each(o.geometry,function(e,o){var t=CreateAtom(o.atom);t.position.set(o.position.x,o.position.y,o.position.z),molecule.addAtom(t);for(var e=0;e<o.bonds.length;e++)BondAtoms(t,molecule.ATOMS[o.bonds[e][0]],o.bonds[e][1]);scene.add(t)}),molecule.setPosition(0,0,0);var t=new THREE.AxisHelper(5);t.position.set(molecule.position.x,molecule.position.y,molecule.position.z),camera.lookAt(t.position),setZoomLevel(e.zoomLevel)}function AddMoleculeInfo(e){$("#moleculeMakeup").html(formatMoleculeMakeup(e.makeup)),$("#atomDescription").html(e.description),$("#atomReadMoreLink").prop("href",e.link)}function ClearScene(){var e=[];$.each(scene.children,function(o,t){("line"==t.name||"atom"==t.name)&&e.push(t)}),$.each(e,function(e,o){scene.remove(o)})}function setZoomLevel(e){var o=e-camera.position.z;camera.translateZ(o)}function formatMoleculeMakeup(e){for(var o=e,t="",n=0;n<o.length;n++){var e;isNaN(o[n])?"^"==o[n]?(e="<sup>"+o[n+1]+"</sup>",n++):e=o[n]:e="<sub>"+o[n]+"</sub>",t+=e}return t}function Rads2Degs(e){return 180*e/Math.PI}function Degs2Rads(e){return e*Math.PI/180}function getDistance(e,o){var t=o.x-e.x,n=o.y-e.y,i=Math.sqrt(t*t+n*n);return i}function resetAngles(){totalRotation.reset(),scene.rotation.set(0,0,0)}function setAngles(){scene.rotation.x=0,scene.rotation.y=0,scene.rotation.z=0,totalRotation.reset()}function render(){requestAnimationFrame(render),renderer.render(scene,camera),autoRotate&&spinObj(scene,"y",.005)}function spinObj(e,o,t){"X"==o.toUpperCase()?(totalRotation.x+=t,e.rotateX(t)):"Y"==o.toUpperCase()?(totalRotation.y+=t,e.rotateY(t)):"Z"==o.toUpperCase()&&(totalRotation.z+=t,e.rotateZ(t))}function onWindowResize(){windowHalfX=window.innerWidth/2,windowHalfY=window.innerHeight/2,camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight)}var debug=!1,output=$("#output"),debugKeys=!1,plane,cube,sphere,scene,camera,renderer,controls,autoRotate=!debug,totalRotation={x:0,y:0,z:0,set:function(e,o,t){totalRotation.x=e,totalRotation.y=o,totalRotation.z=t},reset:function(){totalRotation.x=0,totalRotation.y=0,totalRotation.z=0},mod:function(){totalRotation.x%=2*Math.PI,totalRotation.y%=2*Math.PI,totalRotation.z%=2*Math.PI}},keys=[],molecule={addAtom:function(e){this.ATOMS.push(e);var o=1e5,t=1e5,n=1e5,i=-1e5,a=-1e5,s=-1e5;$.each(this.ATOMS,function(e,r){r.position.x<o&&(o=r.position.x),r.position.x>i&&(i=r.position.x),r.position.y<t&&(t=r.position.y),r.position.y>a&&(a=r.position.y),r.position.z<n&&(n=r.position.z),r.position.z>s&&(s=r.position.z)}),this.position=new THREE.Vector3((i+o)/2,(a+t)/2,(s+n)/2)},ATOMS:[],BONDS:[],position:new THREE.Vector3,setPosition:function(e,o,t){var n=e-this.position.x,i=o-this.position.y,a=t-this.position.z;$.each(this.ATOMS,function(e,o){o.position.x+=n,o.position.y+=i,o.position.z+=a}),$.each(this.BONDS,function(e,o){o.position.x+=n,o.position.y+=i,o.position.z+=a}),this.position.x+=n,this.position.y+=i,this.position.z+=a},reset:function(){this.ATOMS=[],this.position=new THREE.Vector3}},KEY_CODES={CTRL:17,ALT:18,ARROW_LEFT:37,ARROW_UP:38,ARROW_RIGHT:39,ARROW_DOWN:40,KEY_A:65,KEY_R:82},ATOMS={HYDROGEN:{number:1,radius:1,shortName:"H",fullName:"Hydrogen",color:"#E5E5E5",textColor:"#333333"},CARBON:{number:6,radius:2.4516129032258,shortName:"C",fullName:"Carbon",color:"#555555",textColor:"#E5E5E5"},NITROGEN:{number:7,radius:2.2903225806452,shortName:"N",fullName:"Nitrogen",color:"#5533AA",textColor:"#E5E5E5"},OXYGEN:{number:8,radius:2.1290322580645,shortName:"O",fullName:"Oxygen",color:"#CC3333",textColor:"#E5E5E5"},SODIUM:{number:11,radius:5.3548387096774,shortName:"Na",fullName:"Sodium",color:"#AA33AA",textColor:"#E5E5E5"},POTASSIUM:{number:19,radius:6.5483870967742,shortName:"K",fullName:"Potassium",color:"#AABB33",textColor:"#333333"},CALCIUM:{number:20,radius:5.6774193548387,shortName:"Ca",fullName:"Calcium",color:"#33BB33",textColor:"#333333"}},ATOM_INFO=[{fullName:"Hydrogen",shortName:"H",number:1,description:"Hydrogen is a chemical element with chemical symbol H and atomic number 1. With an atomic weight of 1.00794 u, hydrogen is the lightest element on the periodic table. Its monatomic form (H) is the most abundant chemical substance in the Universe, constituting roughly 75% of all baryonic mass. Non-remnant stars are mainly composed of hydrogen in its plasma state. The most common isotope of hydrogen, termed protium (name rarely used, symbol 1H), has one proton and no neutrons.",link:"https://en.wikipedia.org/wiki/Hydrogen"},{fullName:"Carbon",shortName:"C",number:6,description:'Carbon (from Latin: carbo "coal") is a chemical element with symbol C and atomic number 6. On the periodic table, it is the first (row 2) of six elements in column (group) 14, which have in common the composition of their outer electron shell. It is nonmetallic and tetravalent—making four electrons available to form covalent chemical bonds. There are three naturally occurring isotopes, with 12C and 13C being stable, while 14C is radioactive, decaying with a half-life of about 5,730 years. Carbon is one of the few elements known since antiquity.',link:"https://en.wikipedia.org/wiki/Carbon"},{fullName:"Nitrogen",shortName:"N",number:7,description:"Nitrogen is a chemical element with symbol N and atomic number 7. It is the lightest pnictogen and at room temperature, it is a transparent, odorless diatomic gas. Nitrogen is a common element in the universe, estimated at about seventh in total abundance in the Milky Way and the Solar System. On Earth, the element forms about 78% of Earth's atmosphere and as such is the most abundant uncombined element. The element nitrogen was discovered as a separable component of air, by Scottish physician Daniel Rutherford, in 1772.",link:"https://en.wikipedia.org/wiki/Nitrogen"},{fullName:"Oxygen",shortName:"O",number:8,description:"Oxygen is a chemical element with symbol O and atomic number 8. It is a member of the chalcogen group on the periodic table and is a highly reactive nonmetal and oxidizing agent that readily forms compounds (notably oxides) with most elements. By mass, oxygen is the third-most abundant element in the universe, after hydrogen and helium. At standard temperature and pressure, two atoms of the element bind to form dioxygen, a colorless and odorless diatomic gas with the formula O2. Diatomic oxygen gas constitutes 20.8% of the Earth's atmosphere. However, monitoring of atmospheric oxygen levels show a global downward trend, because of fossil-fuel burning. Oxygen is the most abundant element by mass in the Earth's crust as part of oxide compounds such as silicon dioxide, making up almost half of the crust's mass.",link:"https://en.wikipedia.org/wiki/Oxygen"}],ATOMS_ARRAY=[ATOMS.HYDROGEN,ATOMS.CARBON,ATOMS.NITROGEN,ATOMS.OXYGEN,ATOMS.SODIUM,ATOMS.POTASSIUM,ATOMS.CALCIUM],MOLECULES={WATER:{name:"Water",makeup:"H2O",geometry:[{atom:ATOMS.OXYGEN,position:new THREE.Vector3(0,0,0),bonds:[]},{atom:ATOMS.HYDROGEN,position:new THREE.Vector3(3,-3,0),bonds:[[0]]},{atom:ATOMS.HYDROGEN,position:new THREE.Vector3(-3,-3,0),bonds:[[0]]}],zoomLevel:30},ETHANOL:{name:"Ethanol",makeup:"C2H6O",geometry:[{atom:ATOMS.CARBON,position:new THREE.Vector3(0,0,0),bonds:[]},{atom:ATOMS.HYDROGEN,position:new THREE.Vector3(-4.5,3.5,0),bonds:[[0]]},{atom:ATOMS.HYDROGEN,position:new THREE.Vector3(-3.5,-3.5,-3),bonds:[[0]]},{atom:ATOMS.HYDROGEN,position:new THREE.Vector3(-3.5,-3.5,3),bonds:[[0]]},{atom:ATOMS.CARBON,position:new THREE.Vector3(9,0,0),bonds:[[0]]},{atom:ATOMS.OXYGEN,position:new THREE.Vector3(12,6,0),bonds:[[4]]},{atom:ATOMS.HYDROGEN,position:new THREE.Vector3(17,6,0),bonds:[[5]]},{atom:ATOMS.HYDROGEN,position:new THREE.Vector3(12.5,-3.5,-3),bonds:[[4]]},{atom:ATOMS.HYDROGEN,position:new THREE.Vector3(12.5,-3.5,3),bonds:[[4]]}],zoomLevel:30},CAFFEINE:{name:"Caffeine",makeup:"C8H10N4O2",geometry:[{atom:ATOMS.HYDROGEN,position:new THREE.Vector3(0,0,-3.5),bonds:[]},{atom:ATOMS.HYDROGEN,position:new THREE.Vector3(0,0,3.5),bonds:[]},{atom:ATOMS.HYDROGEN,position:new THREE.Vector3(-3,-6,0),bonds:[]},{atom:ATOMS.CARBON,position:new THREE.Vector3(0,-3,0),bonds:[[0],[1],[2]]},{atom:ATOMS.NITROGEN,position:new THREE.Vector3(6,-6,0),bonds:[[3]]},{atom:ATOMS.CARBON,position:new THREE.Vector3(12,-3,0),bonds:[[4]]},{atom:ATOMS.OXYGEN,position:new THREE.Vector3(12,3,0),bonds:[[5,2]]},{atom:ATOMS.CARBON,position:new THREE.Vector3(18,-6,0),bonds:[[5]]},{atom:ATOMS.NITROGEN,position:new THREE.Vector3(24,-4,0),bonds:[[7]]},{atom:ATOMS.CARBON,position:new THREE.Vector3(26,2,0),bonds:[[8]]},{atom:ATOMS.HYDROGEN,position:new THREE.Vector3(25,5,-3.5),bonds:[[9]]},{atom:ATOMS.HYDROGEN,position:new THREE.Vector3(25,5,3.5),bonds:[[9]]},{atom:ATOMS.HYDROGEN,position:new THREE.Vector3(31,3,0),bonds:[[9]]},{atom:ATOMS.CARBON,position:new THREE.Vector3(28.5,-8.7,0),bonds:[[8]]},{atom:ATOMS.HYDROGEN,position:new THREE.Vector3(34,-8.7,0),bonds:[[13]]},{atom:ATOMS.NITROGEN,position:new THREE.Vector3(24.5,-13.5,0),bonds:[[13,2]]},{atom:ATOMS.CARBON,position:new THREE.Vector3(18,-12,0),bonds:[[15],[7,2]]},{atom:ATOMS.NITROGEN,position:new THREE.Vector3(12,-15,0),bonds:[[16]]},{atom:ATOMS.CARBON,position:new THREE.Vector3(12,-21,0),bonds:[[17]]},{atom:ATOMS.HYDROGEN,position:new THREE.Vector3(7.5,-23,0),bonds:[[18]]},{atom:ATOMS.HYDROGEN,position:new THREE.Vector3(15,-23,-3.5),bonds:[[18]]},{atom:ATOMS.HYDROGEN,position:new THREE.Vector3(15,-23,3.5),bonds:[[18]]},{atom:ATOMS.CARBON,position:new THREE.Vector3(6,-12,0),bonds:[[17],[4]]},{atom:ATOMS.OXYGEN,position:new THREE.Vector3(0,-15,0),bonds:[[22,2]]}],zoomLevel:42},ISOPROPYL_ALCOHOL:{name:"Isopropyl Alcohol",makeup:"(CH3)2CHOH",geometry:[{atom:ATOMS.HYDROGEN,position:new THREE.Vector3(0,0,0),bonds:[]},{atom:ATOMS.HYDROGEN,position:new THREE.Vector3(3,-6,-3.5),bonds:[]},{atom:ATOMS.HYDROGEN,position:new THREE.Vector3(3,-6,3.5),bonds:[]},{atom:ATOMS.CARBON,position:new THREE.Vector3(4.5,-2,0),bonds:[[0],[1],[2]]},{atom:ATOMS.CARBON,position:new THREE.Vector3(10,4,0),bonds:[[3]]},{atom:ATOMS.HYDROGEN,position:new THREE.Vector3(10,8,3.5),bonds:[[4]]},{atom:ATOMS.OXYGEN,position:new THREE.Vector3(10,8,-6),bonds:[[4]]},{atom:ATOMS.HYDROGEN,position:new THREE.Vector3(6,10,-6),bonds:[[6]]},{atom:ATOMS.CARBON,position:new THREE.Vector3(15,-2,0),bonds:[[4]]},{atom:ATOMS.HYDROGEN,position:new THREE.Vector3(19,0,0),bonds:[[8]]},{atom:ATOMS.HYDROGEN,position:new THREE.Vector3(16,-6,-3.5),bonds:[[8]]},{atom:ATOMS.HYDROGEN,position:new THREE.Vector3(16,-6,3.5),bonds:[[8]]}],zoomLevel:30},OCTO_CARBON:{name:"OCTO CARBON",makeup:"TEST",geometry:[{atom:ATOMS.CARBON,position:new THREE.Vector3(0,0,0),bonds:[]},{atom:ATOMS.CARBON,position:new THREE.Vector3(10,0,0),bonds:[[0]]},{atom:ATOMS.CARBON,position:new THREE.Vector3(17.07,-7.07,0),bonds:[[1]]},{atom:ATOMS.CARBON,position:new THREE.Vector3(17.07,-17.07,0),bonds:[[2]]},{atom:ATOMS.CARBON,position:new THREE.Vector3(10,-23.07,0),bonds:[[3]]},{atom:ATOMS.CARBON,position:new THREE.Vector3(0,-23.07,0),bonds:[[4]]},{atom:ATOMS.CARBON,position:new THREE.Vector3(-7.07,-17.07,0),bonds:[[5]]},{atom:ATOMS.CARBON,position:new THREE.Vector3(-7.07,-7.07,0),bonds:[[6],[0]]}],zoomLevel:45},TRINITROTOLUENE:{name:"(TNT) Trinitrotoluene",makeup:"C6H2(NO2)3CH3",geometry:[{atom:ATOMS.CARBON,position:new THREE.Vector3(0,-2,0),bonds:[]},{atom:ATOMS.CARBON,position:new THREE.Vector3(6,2,0),bonds:[[0,2]]},{atom:ATOMS.CARBON,position:new THREE.Vector3(12,-2,0),bonds:[[1]]},{atom:ATOMS.CARBON,position:new THREE.Vector3(12,-10,0),bonds:[[2,2]]},{atom:ATOMS.CARBON,position:new THREE.Vector3(6,-14,0),bonds:[[3]]},{atom:ATOMS.CARBON,position:new THREE.Vector3(0,-10,0),bonds:[[4,2],[0]]},{atom:ATOMS.NITROGEN,position:new THREE.Vector3(-7,1,0),bonds:[[0]]},{atom:ATOMS.OXYGEN,position:new THREE.Vector3(-10,7,-3),bonds:[[6,2]]},{atom:ATOMS.OXYGEN,position:new THREE.Vector3(-13,-2,3),bonds:[[6]]},{atom:ATOMS.CARBON,position:new THREE.Vector3(6,10,0),bonds:[[1]]},{atom:ATOMS.HYDROGEN,position:new THREE.Vector3(3,12,4),bonds:[[9]]},{atom:ATOMS.HYDROGEN,position:new THREE.Vector3(3,12,-4),bonds:[[9]]},{atom:ATOMS.HYDROGEN,position:new THREE.Vector3(11,12,0),bonds:[[9]]},{atom:ATOMS.NITROGEN,position:new THREE.Vector3(19,1,0),bonds:[[2]]},{atom:ATOMS.OXYGEN,position:new THREE.Vector3(21,7,3),bonds:[[13]]},{atom:ATOMS.OXYGEN,position:new THREE.Vector3(25,-2,-3),bonds:[[13,2]]},{atom:ATOMS.HYDROGEN,position:new THREE.Vector3(17,-13,0),bonds:[[3]]},{atom:ATOMS.NITROGEN,position:new THREE.Vector3(6,-21,0),bonds:[[4]]},{atom:ATOMS.OXYGEN,position:new THREE.Vector3(1,-24,-3),bonds:[[17]]},{atom:ATOMS.OXYGEN,position:new THREE.Vector3(11,-24,3),bonds:[[17,2]]},{atom:ATOMS.HYDROGEN,position:new THREE.Vector3(-5,-13,0),bonds:[[5]]}],zoomLevel:54}},MOLECULE_INFO=[{name:"Water",makeup:"H2O",description:"Water "+formatMoleculeMakeup("(H2O)")+" is the most abundant compound on Earth's surface, covering 70 percent of the planet. In nature, water exists in liquid, solid, and gaseous states. It is in dynamic equilibrium between the liquid and gas states at standard temperature and pressure. At room temperature, it is a tasteless and odorless liquid, nearly colorless with a hint of blue. Many substances dissolve in water and it is commonly referred to as the universal solvent. Because of this, water in nature and in use is rarely pure and some properties may vary from those of the pure substance. However, there are also many compounds that are essentially, if not completely, insoluble in water. Water is the only common substance found naturally in all three common states of matter and it is essential for all life on Earth. Water makes up 55% to 78% of the human body.",link:"https://en.wikipedia.org/wiki/Properties_of_water"},{name:"Ethanol",makeup:"C2H6O",description:"Ethanol /ɛθənɒl/, also commonly called ethyl alcohol, drinking alcohol, or simply alcohol is the principal type of alcohol found in alcoholic beverages, produced by the fermentation of sugars by yeasts. It is a neurotoxic psychoactive drug and one of the oldest recreational drugs used by humans. It can cause alcohol intoxication when consumed in sufficient quantity. Ethanol is a volatile, flammable, colorless liquid with a slight chemical odor. It is used as an antiseptic, a solvent, a fuel, and, due to its low freezing point, the active fluid in post-mercury thermometers. The molecule is a simple one, being an ethyl group linked to a hydroxyl group. Its structural formula, "+formatMoleculeMakeup("CH3CH2OH")+", is often abbreviated as "+formatMoleculeMakeup("C2H5OH")+", "+formatMoleculeMakeup("C2H6O")+" or EtOH.",link:"https://en.wikipedia.org/wiki/Ethanol"},{name:"Caffeine",makeup:"C8H10N4O2",description:"Caffeine is a central nervous system (CNS) stimulant of the methylxanthine class. It is the world's most widely consumed psychoactive drug, but — unlike many other psychoactive substances — it is legal and unregulated in nearly all parts of the world. There are several known mechanisms of action to explain the effects of caffeine. The most prominent is that it reversibly blocks the action of adenosine on its receptor and consequently prevents the onset of drowsiness induced by adenosine. Caffeine also stimulates certain portions of the autonomic nervous system.",link:"https://en.wikipedia.org/wiki/Caffeine"},{name:"Isopropyl Alcohol",makeup:"(CH3)2CHOH",description:"Isopropyl alcohol (IUPAC name propan-2-ol), also called isopropanol or dimethyl carbinol, is a compound with the chemical formula "+formatMoleculeMakeup("C3H8O")+" or "+formatMoleculeMakeup("C3H7OH")+" or "+formatMoleculeMakeup("CH3CHOHCH3")+" (sometimes represented as i-PrOH). It is a colorless, flammable chemical compound with a strong odor. As a propyl group linked to a hydroxyl group, it is the simplest example of a secondary alcohol, where the alcohol carbon atom is attached to two other carbon atoms, sometimes shown as "+formatMoleculeMakeup("(CH3)2CHOH")+". It is a structural isomer of 1-propanol. It has a wide variety of industrial and household uses.",link:"https://en.wikipedia.org/wiki/Isopropyl_alcohol"},{name:"(TNT) Trinitrotoluene",makeup:"C6H2(NO2)3CH3",description:"Trinitrotoluene (/ˌtraɪˌnaɪtroʊˈtɒljuːˌiːn, -ljəˌwiːn/; TNT), or more specifically 2,4,6-trinitrotoluene, is a chemical compound with the formula "+formatMoleculeMakeup("C6H2(NO2)3CH3")+". This yellow-colored solid is sometimes used as a reagent in chemical synthesis, but it is best known as an explosive material with convenient handling properties. The explosive yield of TNT is considered to be the standard measure of bombs and other explosives. In chemistry, TNT is used to generate charge transfer salts. While the two words are sometimes used interchangeably in common conversation, TNT is not the same as dynamite, a special formatting of nitroglycerin for use as an industrial explosive.",link:"https://en.wikipedia.org/wiki/Trinitrotoluene"}],MOLECULE_ARRAY=[MOLECULES.WATER,MOLECULES.ETHANOL,MOLECULES.CAFFEINE,MOLECULES.ISOPROPYL_ALCOHOL,MOLECULES.TRINITROTOLUENE],mol=MOLECULES.TRINITROTOLUENE,selectedMolecule=4;$(function(){camera=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,.1,1e3),scene=new THREE.Scene,renderer=new THREE.WebGLRenderer,renderer.setClearColor(1118481),renderer.setSize(window.innerWidth,window.innerHeight);var e=new THREE.DirectionalLight(16777215);e.position.set(0,0,1).normalize(),scene.add(e);var o=new THREE.DirectionalLight(16777215);o.position.set(0,0,-1).normalize(),scene.add(o);var t=new THREE.DirectionalLight(16777215);t.position.set(1,0,0).normalize(),scene.add(t);var n=new THREE.DirectionalLight(16777215);n.position.set(-1,0,0).normalize(),scene.add(n);var i=new THREE.DirectionalLight(16777215);i.position.set(0,1,0).normalize(),scene.add(i);var a=new THREE.DirectionalLight(16777215);a.position.set(0,-1,0).normalize(),scene.add(a);new THREE.Vector3(0,0,0);camera.position.x=0,camera.position.y=0,camera.position.z=0,AddMolecule(mol),AddMoleculeInfo(MOLECULE_INFO[selectedMolecule]);var r=new THREE.AxisHelper(5);r.position.set(molecule.position.x,molecule.position.y,molecule.position.z),debug&&scene.add(r),camera.lookAt(r.position),output.append(renderer.domElement),renderer.render(scene,camera);var l=$("#moleculeSelect");l.html(""),$.each(MOLECULE_ARRAY,function(e,o){var t;t=o!=mol?"<option value='"+e+"'>"+o.name+"</option>":"<option value='"+e+"' selected>"+o.name+"</option>",l.append(t)}),$("#autoRotate").change(function(){autoRotate=!autoRotate}),$("#moleculeSelect").change(function(e){selectedMolecule=e.originalEvent.target.value,AddMolecule(MOLECULE_ARRAY[selectedMolecule]),AddMoleculeInfo(MOLECULE_INFO[selectedMolecule]),resetAngles()});var c,m,u;$(output).mousedown(function(e){c=!0,output.addClass("grab"),u=Array(e.offsetX,e.offsetY)}).bind("mouseup mouseleave",function(){c=!1,output.removeClass("grab")});var d,E=new THREE.Raycaster,p=new THREE.Vector2;$(output).on("mousemove",function(e){if(e.preventDefault(),output.removeClass("info"),void 0!==d&&(d.emissive=new THREE.Color(0,0,0)),c){$("#autoRotate").prop("checked",""),autoRotate=!1,m=Array(e.offsetX,e.offsetY);var o=(u[0]-m[0])/50,t=(u[1]-m[1])/50,s=(Math.abs(Math.round(100*Rads2Degs(scene.rotation.x))/100),Math.abs(Math.round(100*Rads2Degs(scene.rotation.y))/100),Math.abs(Math.round(100*Rads2Degs(scene.rotation.z))/100),t*Math.sin(scene.rotation.y));t*=Math.cos(scene.rotation.y),scene.rotation.y<Math.PI/2&&Math.abs(scene.rotation.x)>Math.PI/2?totalRotation.x+=t:totalRotation.x-=t,totalRotation.y-=o,totalRotation.z-=s,scene.rotateX(scene.rotation.y<Math.PI/2&&Math.abs(scene.rotation.x)>Math.PI/2?t/4:-t/4),scene.rotateY(-o/4),scene.rotateZ(-s/4),console.clear(),console.log(scene.rotation),u=m}else{p.x=event.clientX/window.innerWidth*2-1,p.y=2*-(event.clientY/window.innerHeight)+1,E.setFromCamera(p,camera);var r=E.intersectObjects(molecule.ATOMS);r.length>0&&(d=r[0].object.material,d.emissive=new THREE.Color(.2,.2,.2),output.addClass("info"))}}),$(output).on("touchstart",function(e){c=!0,u=Array(e.originalEvent.touches[0].screenX,e.originalEvent.touches[0].screenY),2===e.originalEvent.touches.length&&(O=getDistance(new THREE.Vector2(e.originalEvent.touches[0].screenX,e.originalEvent.touches[0].screenY),new THREE.Vector2(e.originalEvent.touches[1].screenX,e.originalEvent.touches[1].screenY)))}).bind("touchend touchcancel",function(){c=!1});var h,u,O;$(output).on("touchmove",function(e){if(e.preventDefault(),c)if(1===e.originalEvent.touches.length){$("#autoRotate").prop("checked",""),autoRotate=!1,h=Array(e.originalEvent.touches[0].screenX,e.originalEvent.touches[0].screenY);var o=(u[0]-h[0])/50,t=(u[1]-h[1])/50,s=(Math.abs(Math.round(100*Rads2Degs(scene.rotation.x))/100),Math.abs(Math.round(100*Rads2Degs(scene.rotation.y))/100),Math.abs(Math.round(100*Rads2Degs(scene.rotation.z))/100),t*Math.sin(scene.rotation.y));t*=Math.cos(scene.rotation.y),scene.rotation.y<Math.PI/2&&Math.abs(scene.rotation.x)>Math.PI/2?totalRotation.x+=o/4:totalRotation.x-=o/4,totalRotation.y-=t/4,totalRotation.z-=s/4,scene.rotateX(scene.rotation.y<Math.PI/2&&Math.abs(scene.rotation.x)>Math.PI/2?t/4:-t/4),scene.rotateY(-o/4),scene.rotateZ(-s/4),u=h}else if(2===e.originalEvent.touches.length){var r=Array(e.originalEvent.touches[0].screenX,e.originalEvent.touches[0].screenY),l=Array(e.originalEvent.touches[1].screenX,e.originalEvent.touches[1].screenY),m=new THREE.Vector2(r[0],r[1]),d=new THREE.Vector2(l[0],l[1]),E=getDistance(m,d),p=(E-O)/5;camera.position.z-p<150&&camera.position.z-p>10&&camera.translateZ(-p),O=E}});var R;$(output).on("mousewheel",function(e){var o=e.originalEvent.wheelDelta/120;o>0?(output.addClass("zoomin"),output.removeClass("zoomout")):(output.addClass("zoomout"),output.removeClass("zoomin")),clearTimeout(R),R=setTimeout(function(){output.removeClass("zoomin"),output.removeClass("zoomout")},500),camera.position.z-o<150&&camera.position.z-o>10&&camera.translateZ(-o)}),$(output).on("mousedown",function(){event.preventDefault();var o=new THREE.Raycaster,t=new THREE.Vector2;t.x=event.clientX/window.innerWidth*2-1,t.y=2*-(event.clientY/window.innerHeight)+1,o.setFromCamera(t,camera);for(var n=o.intersectObjects(molecule.ATOMS),i=Object,a=void 0,s=0;s<n.length;s++)if("atom"==n[s].object.name){i=n[s].object.userData.number,$.each(ATOM_INFO,function(e,o){o.number==i&&(a=o)});break}void 0!==a&&(console.log(a),$("#atomDescription").html(a.description),$("#atomReadMoreLink").prop("href",a.link))}),$("#debugKeys").change(function(e){debugKeys=e.originalEvent.srcElement.checked}),window.addEventListener("resize",onWindowResize,!1),render()});